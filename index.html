<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biblioteca de Fichas de SeguranÃ§a</title>
  <meta name="description" content="Lista automÃ¡tica de PDFs (FDS, FISPQ e outros)">
  <style>
    :root { --gap:1rem; --radius:16px; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    .container{max-width:1000px;margin:0 auto;padding:1.5rem}
    h1{margin:0 0 .5rem} h2{margin:2rem 0 .5rem}
    #search{width:100%;padding:.75rem 1rem;border:1px solid #ddd;border-radius:var(--radius);font-size:1rem}
    .grid{list-style:none;padding:0;margin:var(--gap) 0 0;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:var(--gap)}
    .card a{display:block;padding:1rem;border:1px solid #eee;border-radius:var(--radius);text-decoration:none;color:inherit;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .card a:hover{border-color:#ddd;box-shadow:0 3px 12px rgba(0,0,0,.06)}
    .title{display:block;font-weight:600;margin-bottom:.25rem}.meta{display:block;font-size:.9rem;color:#666}
    footer{border-top:1px solid #eee;margin-top:2rem}
    .muted{color:#777;font-size:.95rem}
    @media (prefers-color-scheme: dark){
      body{background:#0b0b0b;color:#eaeaea}
      #search{background:#161616;border-color:#333;color:#eaeaea}
      .card a{background:#121212;border-color:#222}
      .card a:hover{border-color:#2d2d2d;box-shadow:0 3px 14px rgba(0,0,0,.35)}
      footer{border-color:#1f1f1f}
      .muted{color:#a0a0a0}
    }
  </style>
</head>
<body>
  <header class="container">
    <h1>ðŸ“š Fichas de Dados de SeguranÃ§a</h1>
    <p class="muted">Adicione/exclua PDFs no repositÃ³rio â€” a lista atualiza automaticamente.</p>
    <input id="search" type="search" placeholder="Pesquisarâ€¦ (ex.: WD-40, Molykote, Loctite)">
  </header>

  <main class="container">
    <section>
      <h2>FDS <span id="count-fds" class="muted"></span></h2>
      <ul id="lista-fds" class="grid"></ul>
    </section>
    <section>
      <h2>FISPQ <span id="count-fispq" class="muted"></span></h2>
      <ul id="lista-fispq" class="grid"></ul>
    </section>
    <section id="sec-outros" style="display:none">
      <h2>Outros <span id="count-outros" class="muted"></span></h2>
      <ul id="lista-outros" class="grid"></ul>
    </section>
    <p id="status" class="muted"></p>
  </main>

  <footer class="container" style="font-size:.9rem">
    Ãšltima atualizaÃ§Ã£o: <span id="updated"></span>
  </footer>

  <script>
    const USER   = "Rovsalvador";
    const REPO   = "FDS";
    const PAGES_BASE = `https://${USER}.github.io/${REPO}/`;
    const FOLDERS = ["", "pdfs/"];

    document.getElementById("updated").textContent = new Date().toLocaleDateString("pt-BR");
    const statusEl = document.getElementById("status");

    async function fetchContents(folder, branch){
      const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${folder}?ref=${encodeURIComponent(branch)}`;
      const r = await fetch(url, { headers: { "Accept": "application/vnd.github+json" } });
      if (!r.ok) throw new Error(`HTTP ${r.status} em ${url}`);
      return r.json();
    }
    async function listFolder(folder){
      for (const branch of ["main", "master"]) {
        try {
          const items = await fetchContents(folder, branch);
          return items
            .filter(x => x.type === "file" && /\.pdf$/i.test(x.name))
            .map(x => folder + x.name);
        } catch (_) {}
      }
      return [];
    }
    function pagesHref(path){
      const enc = path.split("/").map(encodeURIComponent).join("/");
      return PAGES_BASE + enc;
    }
    function niceTitle(name){
      return name.replace(/\.pdf$/i, "").trim();
    }
    function cardLi(path){
      const name = path.split("/").pop();
      const li = document.createElement("li");
      li.className = "card";
      li.innerHTML = `
        <a href="${pagesHref(path)}" target="_blank" rel="noopener">
          <span class="title">${niceTitle(name)}</span>
          <span class="meta">PDF</span>
        </a>`;
      return li;
    }

    function categorizeFiles(all) {
      const collator = new Intl.Collator('pt-BR', { sensitivity: 'base' });

      const fds    = all.filter(p => p.toUpperCase().includes("FDS")).sort(collator.compare);
      const fispq  = all.filter(p => p.toUpperCase().includes("FISPQ")).sort(collator.compare);
      const outros = all.filter(
        p => !p.toUpperCase().includes("FDS") && !p.toUpperCase().includes("FISPQ")
      ).sort(collator.compare);

      return { fds, fispq, outros };
    }

    async function load(){
      statusEl.textContent = "Carregandoâ€¦";
      const lists = (await Promise.all(FOLDERS.map(listFolder))).flat();
      const seen = new Set(), all = [];
      for (const p of lists){ const k = p.toLowerCase(); if(!seen.has(k)){ seen.add(k); all.push(p); } }

      if (!all.length){
        statusEl.textContent = "Nenhum PDF encontrado (coloque na raiz ou em /pdfs).";
        return;
      }

      const { fds, fispq, outros } = categorizeFiles(all);

      const elFds = document.getElementById("lista-fds");
      const elFispq = document.getElementById("lista-fispq");
      const elOutros = document.getElementById("lista-outros");
      const secOutros = document.getElementById("sec-outros");

      fds.forEach(p => elFds.appendChild(cardLi(p)));
      fispq.forEach(p => elFispq.appendChild(cardLi(p)));
      if (outros.length) {
        secOutros.style.display = "";
        outros.forEach(p => elOutros.appendChild(cardLi(p)));
      }

      document.getElementById("count-fds").textContent   = `(${fds.length})`;
      document.getElementById("count-fispq").textContent = `(${fispq.length})`;
      if (outros.length) document.getElementById("count-outros").textContent = `(${outros.length})`;

      statusEl.textContent = "";
    }

    document.getElementById("search").addEventListener("input", (ev) => {
      const q = ev.target.value.toLowerCase().trim();
      document.querySelectorAll(".card").forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(q) ? "" : "none";
      });
    });

    load();
  </script>
</body>
</html>
